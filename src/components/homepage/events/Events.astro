---
const events = [
  { id: 1, image: "/images/events/event-one.webp", alt: "Event 1" },
  { id: 2, image: "/images/events/event-two.webp", alt: "Event 2" },
  { id: 3, image: "/images/events/event-three.webp", alt: "Event 3" },
  { id: 4, image: "/images/events/event-four.webp", alt: "Event 4" },
  { id: 5, image: "/images/events/event-five.webp", alt: "Event 5" },
  { id: 6, image: "/images/events/event-six.webp", alt: "Event 6" },
  { id: 7, image: "/images/events/event-seven.webp", alt: "Event 7" },
  { id: 8, image: "/images/events/event-eight.webp", alt: "Event 8" },
  { id: 9, image: "/images/events/event-nine.webp", alt: "Event 9" },
];
---

<section class="events">
  <div class="events-container">
    <h2>Upcoming Events</h2>

    <div class="carousel-wrapper">
      <button class="carousel-btn carousel-btn-prev" aria-label="Previous event">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>

      <div class="carousel">
        <div class="carousel-track">
          {
            events.map((event) => (
              <div class="carousel-slide">
                <img src={event.image} alt={event.alt} loading="lazy" />
              </div>
            ))
          }
        </div>
      </div>

      <button class="carousel-btn carousel-btn-next" aria-label="Next event">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>

    <div class="carousel-dots"></div>
  </div>
</section>

<script>
  const track = document.querySelector('.carousel-track') as HTMLElement;
  const slides = Array.from(document.querySelectorAll('.carousel-slide'));
  const prevBtn = document.querySelector('.carousel-btn-prev') as HTMLButtonElement;
  const nextBtn = document.querySelector('.carousel-btn-next') as HTMLButtonElement;
  const dotsContainer = document.querySelector('.carousel-dots') as HTMLElement;

  let currentIndex = 0;
  let slidesPerView = getSlidesPerView();
  const totalSlides = slides.length;

  function getSlidesPerView() {
    if (window.innerWidth >= 1024) return 3;
    if (window.innerWidth >= 768) return 2;
    return 1;
  }

  function updateCarousel() {
    const slideWidth = 100 / slidesPerView;
    const offset = -(currentIndex * slideWidth);
    track.style.transform = `translateX(${offset}%)`;

    // Update dots
    const dots = dotsContainer.querySelectorAll('.carousel-dot');
    dots.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentIndex);
    });
  }

  function createDots() {
    dotsContainer.innerHTML = '';
    const maxIndex = Math.max(0, totalSlides - slidesPerView);

    for (let i = 0; i <= maxIndex; i++) {
      const dot = document.createElement('button');
      dot.classList.add('carousel-dot');
      dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
      if (i === currentIndex) dot.classList.add('active');

      dot.addEventListener('click', () => {
        currentIndex = i;
        updateCarousel();
      });

      dotsContainer.appendChild(dot);
    }
  }

  function nextSlide() {
    const maxIndex = Math.max(0, totalSlides - slidesPerView);
    currentIndex = currentIndex >= maxIndex ? 0 : currentIndex + 1;
    updateCarousel();
  }

  function prevSlide() {
    const maxIndex = Math.max(0, totalSlides - slidesPerView);
    currentIndex = currentIndex <= 0 ? maxIndex : currentIndex - 1;
    updateCarousel();
  }

  prevBtn.addEventListener('click', prevSlide);
  nextBtn.addEventListener('click', nextSlide);

  // Auto-play
  let autoplayInterval = setInterval(nextSlide, 5000);

  // Pause on hover
  const carouselWrapper = document.querySelector('.carousel-wrapper');
  carouselWrapper?.addEventListener('mouseenter', () => {
    clearInterval(autoplayInterval);
  });

  carouselWrapper?.addEventListener('mouseleave', () => {
    autoplayInterval = setInterval(nextSlide, 5000);
  });

  // Handle window resize
  window.addEventListener('resize', () => {
    const newSlidesPerView = getSlidesPerView();
    if (newSlidesPerView !== slidesPerView) {
      slidesPerView = newSlidesPerView;
      currentIndex = 0;
      createDots();
      updateCarousel();
    }
  });

  // Initialize
  createDots();
  updateCarousel();
</script>